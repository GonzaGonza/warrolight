{"version":3,"sources":["lightsSimulator.jsx"],"names":[],"mappings":"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","file":"lightsSimulator.js","sourcesContent":["if (!window.socket) {\n    window.socket = io();\n}\n\nfunction hexToRgb(hex) {\n    let result = hexRegex.exec(hex);\n    return result ? [parseInt(result[1], 16), parseInt(result[2], 16), parseInt(result[3], 16)] : null\n}\n\nclass LightsSimulator extends React.Component {\n    constructor() {\n        super(...arguments)\n\n        this.state = {\n            renderingEnabled: false\n        }\n\n        this.lastFrameTime = performance.now();\n        this.lastFPS = 0;\n        this.frameCount = 0;\n    }\n\n    componentDidMount() {\n        socket.emit('startSamplingLights', (layout) => {\n            this.geometryX = layout.geometry.x\n            this.geometryY = layout.geometry.y\n            this.minX = _.min(this.geometryX)\n            this.minY = _.min(this.geometryY)\n            this.maxX = _.max(this.geometryX)\n            this.maxY = _.max(this.geometryY)\n        });\n\n        socket.on('lightsSample', (lights) => {\n            this.drawCanvas(lights)\n        });\n    }\n\n    componentWillUnmount() {\n        //this.stopCurrent()\n    }\n\n    componentDidUpdate(oldProps, oldState) {\n        if (oldState.func !== this.state.func) {\n            //this.startCurrent()\n        }\n    }\n\n    drawCanvas(lights) {\n        const drawStartTime = performance.now();\n\n        const leds = this.geometryX.length;\n        const ctx = this.refs.canvas.getContext('2d');\n\n        ctx.globalCompositeOperation = 'source-over';\n        ctx.fillStyle = 'black';\n        ctx.fillRect(0, 0, this.props.width, this.props.height);\n\n        ctx.globalCompositeOperation = 'lighter';\n\n        if (this.state.renderingEnabled) {\n            const X = this.geometryX;\n            const Y = this.geometryY;\n\n            for (let i = 0; i < leds; i++) {\n                const color = lights[i];\n                if (color === undefined) {\n                    return;\n                }\n                const [r, g, b] = hexToRgb(color);\n                const x = X[i]*9 + 50;\n                const y = Y[i]*9 + 50;\n\n                let power = r + g + b;\n                if (power < 0) power = 0;\n\n                let lightRadius = (40 + (r + g + b) / (255 * 3) * 80) * 1;\n\n                let m = 2;\n                if (power < 200) {\n                    m = 4;\n                } else if (power < 100) {\n                    m = 8;\n                } else if (power < 50) {\n                    m = 16;\n                }\n                let [or, og, ob] = [r * m, g * m, b * m];\n                if (or > 255) or = 255;\n                if (og > 255) og = 255;\n                if (ob > 255) ob = 255;\n\n                ctx.beginPath();\n\n                lightRadius = lightRadius / 24;\n                ctx.fillStyle = `rgba(${or}, ${og}, ${ob}, 1)`;\n\n                // let gradient = ctx.createRadialGradient(x, y, 0, x, y, lightRadius)\n                // gradient.addColorStop(0,     `rgba(${or}, ${og}, ${ob}, 1)`)\n                // // gradient.addColorStop(0.065, `rgba(${or}, ${og}, ${ob}, 1)`)\n                // gradient.addColorStop(0.25, `rgba(${r}, ${g}, ${b}, 1)`)\n                // // gradient.addColorStop(0.25,  `rgba(${r}, ${g}, ${b}, 0.5)`)\n                // gradient.addColorStop(0.5,   `rgba(${r}, ${g}, ${b}, 0.25)`)\n                // // gradient.addColorStop(1,     `rgba(${0}, ${0}, ${0}, 1)`)\n                // gradient.addColorStop(1,   `rgba(${r}, ${g}, ${b}, 0)`)\n                // ctx.fillStyle = gradient\n\n\n                ctx.arc(x, y, lightRadius, Math.PI * 2, false);\n                ctx.fill();\n            }\n\n            this.frameCount++;\n\n            let drawMilliseconds = performance.now() - drawStartTime;\n            let timeSinceLastFPS = performance.now() - this.lastFrameTime;\n            if (timeSinceLastFPS > 100) {\n                this.lastFPS = 1000 * this.frameCount / timeSinceLastFPS;\n                this.frameCount = 0;\n                this.lastFrameTime = performance.now();\n            }\n\n            ctx.fillStyle = 'white';\n            ctx.font = \"12px sans-serif\";\n\n            ctx.fillText(`Sim overhead FPS: ${Math.floor(1000/drawMilliseconds)}`, 10, 40);\n            ctx.fillText(`FPS: ${this.lastFPS.toFixed(1)}`, 10, 20);\n        }\n    }\n\n    __changeSelection() {\n        this.setState({renderingEnabled: !this.state.renderingEnabled});\n    }\n\n    render() {\n        return <div className=\"lights-sim\">\n            <div>\n                <input type=\"checkbox\" data-id={'renderToggle'} checked={this.state.renderingEnabled}\n                       onChange={this.__changeSelection.bind(this)}/><label>Simular</label>\n            </div>\n            <canvas ref=\"canvas\" width={this.props.width} height={this.props.height}/>\n        </div>\n    }\n}"]}